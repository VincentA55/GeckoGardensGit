[gd_scene load_steps=5 format=3 uid="uid://bvacp6if2o5v3"]

[ext_resource type="Texture2D" uid="uid://bj2ut8klimjri" path="res://Healthring/ringempty.png" id="1_s7dsd"]
[ext_resource type="Texture2D" uid="uid://cts6vjb7arhj7" path="res://Healthring/ringbase.png" id="2_8mo57"]
[ext_resource type="Texture2D" uid="uid://c88ir3qsg34mw" path="res://Healthring/ringfill.png" id="3_0sit1"]

[sub_resource type="GDScript" id="GDScript_mus4l"]
script/source = "@tool
extends Control

# The 3D character whose health this bar represents
var character: Node3D

func setRingChar(char: Node3D) -> void:
	
	character = char
	if not is_instance_valid(character):
		print(\"HealthRing was given an invalid character.\")
		return

	#Connect this script's functions to the character's signals.
	character.hunger_changed.connect(Callable(self, \"update_hunger\"))
	character.died.connect(Callable(self, \"_on_character_died\")) 
	
	# --- ANNOUNCE THE SETUP ---
	print_rich(\"[color=green]HealthRing #%d is now tracking Gecko #%d[/color]\" % [get_instance_id(), character.get_instance_id()])
	

	update_hunger(character.current_hunger, character.hungerMax)



func update_hunger(current_hunger, hungerMax):

	if not is_instance_valid(character):
		return

	print(\"HealthRing for '\", character.name, \"' received update: \", current_hunger, \"/\", hungerMax)

	$TextureProgressBar.value = current_hunger


# Add this function so the ring can remove itself when the character dies.
func _on_character_died():
	queue_free()
"

[node name="Healthring" type="Control"]
custom_minimum_size = Vector2(80, 80)
layout_mode = 3
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
grow_horizontal = 2
grow_vertical = 2
size_flags_horizontal = 4
size_flags_vertical = 4
script = SubResource("GDScript_mus4l")

[node name="TextureProgressBar" type="TextureProgressBar" parent="."]
layout_mode = 2
offset_left = -271.0
offset_top = -274.0
offset_right = 809.0
offset_bottom = 806.0
scale = Vector2(0.5, 0.5)
max_value = 200.0
value = 33.0
allow_lesser = true
fill_mode = 5
texture_under = ExtResource("1_s7dsd")
texture_over = ExtResource("2_8mo57")
texture_progress = ExtResource("3_0sit1")
tint_under = Color(0, 0, 0, 0.227451)
